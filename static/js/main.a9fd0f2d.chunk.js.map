{"version":3,"sources":["Canvas.js","EditTool.js","OutputSelect.js","SizeSelect.js","App.js","reportWebVitals.js","index.js"],"names":["Canvas","props","drawLine","ctx","x1","y1","x2","y2","beginPath","moveTo","lineTo","stroke","useEffect","size","canvas","canvasRef","current","image","OffscreenCanvas","width","height","getContext","fillStyle","fillRect","translate","offset","x","y","rotate","scale","zoom","position","drawImage","data","getImageData","b","i","length","bright","c","contrast","clearRect","putImageData","hint","strokeStyle","text","measureText","textAlign","font","fillText","ref","EditTool","useState","setZoom","setRotate","setBright","setContrast","onZoomChanged","value","onRotateChanged","onBrightChanged","onContrastChanged","className","min","max","onChange","resetRef","onClick","OutputSelect","style","options","map","option","Option","name","SizeSelect","App","sizeValue","setSizeValue","setImage","setPosition","setOffset","outputValue","setOutputValue","setHint","mouseState","setMouseState","mouseDown","setMouseDown","useRef","photoSizes","outputSizes","photoSize","outputSize","numX","Math","floor","numY","dx","dy","offscreen","j","convertToBlob","type","quality","then","blob","reader","FileReader","addEventListener","download","document","createElement","href","result","click","readAsDataURL","onMouseDown","event","button","target","tagName","nativeEvent","clientX","clientY","onMouseMove","onMouseUp","cos","sin","input","accept","onchange","src","files","parseInt","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.a9fd0f2d.chunk.js","sourcesContent":["import { useEffect } from 'react';\nimport './Canvas.css';\n\nfunction Canvas(props) {\n  const bright = (data, b) => {\n    if (b === 1)\n      return;\n\n    for (let i = 0; i < data.length; i += 4) {\n      data[i] *= b;\n      data[i + 1] *= b;\n      data[i + 2] *= b;\n    }\n  };\n\n  const contrast = (data, c) => {\n    if (c === 1)\n      return;\n\n    for (let i = 0; i < data.length; i += 4) {\n      data[i] = (data[i] - 128) * c + 128;\n      data[i + 1] = (data[i + 1] - 128) * c + 128;\n      data[i + 2] = (data[i + 2] - 128) * c + 128;\n    }\n  };\n\n  const drawLine = (ctx, x1, y1, x2, y2) => {\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.stroke();\n  };\n\n  useEffect(() => {\n    const size = props.size;\n    const canvas = props.canvasRef.current;\n    if (props.image) {\n      const offscreen = new OffscreenCanvas(size.width, size.height);\n      let ctx = offscreen.getContext('2d');\n      ctx.fillStyle = '#ffffff';\n      ctx.fillRect(0, 0, size.width, size.height);\n      ctx.translate(size.width / 2, size.height / 2);\n      ctx.translate(props.offset.x, props.offset.y);\n      ctx.rotate(props.rotate);\n      ctx.scale(props.zoom, props.zoom);\n      ctx.translate(props.position.x, props.position.y);\n      ctx.drawImage(props.image, -size.width / 2, -size.height / 2);\n      const data = ctx.getImageData(0, 0, size.width, size.height);\n      bright(data.data, props.bright);\n      contrast(data.data, props.contrast);\n\n      ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, size.width, size.height);\n      ctx.putImageData(data, 0, 0);\n\n      if (props.hint) {\n        ctx.strokeStyle = '#ffffffa0';\n        const y1 = size.height / 8;\n        drawLine(ctx, 0, y1, size.width, y1);\n        const y2 = y1 + size.height * 2 / 3;\n        drawLine(ctx, 0, y2, size.width, y2);\n        let x = size.width / 2;\n        drawLine(ctx, x, y1, x, y2);\n      }\n    } else {\n      const ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, size.width, size.height);\n      const text = '點擊此處載入圖檔';\n      const metrics = ctx.measureText(text);\n      ctx.fillStyle = '#000000';\n      ctx.textAlign = 'center';\n      ctx.font = '28px sans-serif';\n      ctx.fillText(text, size.width / 2, size.height / 2);\n    }\n  }, [props]);\n\n  return (\n    <canvas ref={props.canvasRef} width={props.size.width} height={props.size.height} />\n  );\n}\n\nexport default Canvas;\n","import { useState } from 'react';\nimport { Slider } from 'antd';\nimport './EditTool.css';\nimport 'antd/dist/antd.css';\n\nfunction EditTool(props) {\n  const [zoom, setZoom] = useState(100);\n  const [rotate, setRotate] = useState(0);\n  const [bright, setBright] = useState(100);\n  const [contrast, setContrast] = useState(100);\n\n  const onZoomChanged = (value) => {\n    setZoom(value);\n    props.onZoomChanged(value / 100);\n  };\n\n  const onRotateChanged = (value) => {\n    setRotate(value);\n    props.onRotateChanged(value * 3.1416 / 180);\n  };\n\n  const onBrightChanged = (value) => {\n    setBright(value);\n    props.onBrightChanged(value / 100);\n  };\n\n  const onContrastChanged = (value) => {\n    setContrast(value);\n    props.onContrastChanged(value / 100);\n  };\n\n  const onReset = () => {\n    onZoomChanged(100);\n    onRotateChanged(0);\n    onBrightChanged(100);\n    onContrastChanged(100);\n  };\n\n  return (\n    <>\n      <div className='row'><span>大小</span><Slider min={20} max={300} value={zoom} onChange={onZoomChanged} /></div>\n      <div className='row'><span>旋轉</span><Slider min={-180} max={180} value={rotate} onChange={onRotateChanged} /></div>\n      <div className='row'><span>亮度</span><Slider min={50} max={200} value={bright} onChange={onBrightChanged} /></div>\n      <div className='row'><span>對比</span><Slider min={50} max={200} value={contrast} onChange={onContrastChanged} /></div>\n      <button ref={props.resetRef} className='hidden' onClick={onReset}>Reset</button>\n    </>\n  );\n}\n\nexport default EditTool;\n","import { Select } from 'antd';\nimport 'antd/dist/antd.css';\n\nfunction OutputSelect(props) {\n  return (\n    <>\n      選擇輸出尺寸\n      <Select style={{width:230}} value={props.value} onChange={props.onChange}>\n      {\n        props.options.map((option, i) => {\n          return <Select.Option value={i} key={i}>{option.name}</Select.Option>;\n        })\n      }\n      </Select>\n    </>\n  );\n}\n\nexport default OutputSelect;\n","import { Select } from 'antd';\nimport 'antd/dist/antd.css';\n\nfunction SizeSelect(props) {\n  return (\n    <>\n      選擇照片尺寸\n      <Select style={{width:230}} value={props.value} onChange={props.onChange}>\n      {\n        props.options.map((option, i) => {\n          return <Select.Option value={i} key={i}>{option.name}</Select.Option>;\n        })\n      }\n      </Select>\n    </>\n  );\n}\n\nexport default SizeSelect;\n","import { useEffect, useRef, useState } from 'react';\nimport Canvas from './Canvas';\nimport EditTool from './EditTool';\nimport OutputSelect from './OutputSelect';\nimport SizeSelect from './SizeSelect';\nimport { Button } from 'antd';\nimport 'antd/dist/antd.css';\nimport './App.css';\n\nfunction App() {\n  const [sizeValue, setSizeValue] = useState(0);\n  const [image, setImage] = useState(null);\n  const [position, setPosition] = useState({x: 0, y: 0});\n  const [offset, setOffset] = useState({x: 0, y: 0});\n  const [zoom, setZoom] = useState(1);\n  const [rotate, setRotate] = useState(0);\n  const [bright, setBright] = useState(1);\n  const [contrast, setContrast] = useState(1);\n  const [outputValue, setOutputValue] = useState(0);\n  const [hint, setHint] = useState(true);\n  const [mouseState, setMouseState] = useState(0);\n  const [mouseDown, setMouseDown] = useState({});\n  const canvasRef = useRef();\n  const resetRef = useRef();\n\n  const photoSizes = [\n    {\n      width: 331,\n      height: 413,\n      name: '1 吋證件照 (2.8 x 3.5 公分)'\n    },\n    {\n      width: 413,\n      height: 531,\n      name: '2 吋大頭照 (3.5 x 4.5 公分)'\n    },\n    {\n      width: 496,\n      height: 555,\n      name: '2 吋半身照 (4.2 x 4.7 公分)'\n    },\n    {\n      width: 591,\n      height: 591,\n      name: '美國簽證 (5 x 5 公分)'\n    },\n    {\n      width: 354,\n      height: 472,\n      name: '日本簽證 (3 x 4 公分)'\n    }\n  ];\n  const outputSizes = [\n    {\n      width: 0,\n      height: 0,\n      name: '單張圖檔'\n    },\n    {\n      width: 1500,\n      height: 900,\n      name: '3 x 5 吋照片'\n    },\n    {\n      width: 1800,\n      height: 1200,\n      name: '4 x 6 吋照片'\n    }\n  ];\n\n  const reset = () => {\n    setPosition({x: 0, y: 0});\n    setOffset({x: 0, y: 0});\n    setHint(true);\n    // Click reset button in EditTool.\n    resetRef.current.click();\n  };\n\n  const onSizeChanged = (value) => {\n    setSizeValue(parseInt(value));\n    setHint(true);\n  };\n\n  const onZoomChanged = (value) => {\n    setZoom(value);\n    setHint(true);\n  };\n\n  const onRotateChanged = (value) => {\n    setRotate(value);\n    setHint(true);\n  };\n\n  const onSaveFile = () => {\n    setHint(false);\n  };\n\n  const onMouseDown = (event) => {\n    if (event.button !== 0 || event.target.tagName !== 'CANVAS')\n      return;\n\n    setMouseState(1);\n    setMouseDown({\n      x: event.nativeEvent.clientX,\n      y: event.nativeEvent.clientY\n    });\n    setHint(true);\n  };\n\n  const onMouseMove = (event) => {\n    if (mouseState === 0)\n      return;\n\n    if (mouseState === 1)\n      setMouseState(2);\n    setOffset({\n      x: event.nativeEvent.clientX - mouseDown.x,\n      y: event.nativeEvent.clientY - mouseDown.y\n    });\n  };\n\n  const onMouseUp = (event) => {\n    const cos = Math.cos(rotate);\n    const sin = Math.sin(rotate);\n    setPosition({\n      x: position.x + (offset.x * cos + offset.y * sin) / zoom,\n      y: position.y + (-offset.x * sin + offset.y * cos) / zoom\n    });\n    setOffset({x: 0, y: 0});\n  };\n\n  const onClick = (event) => {\n    if (mouseState !== 2 && event.target.tagName === 'CANVAS') {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = 'image/*';\n      input.onchange = (event) => {\n        const reader = new FileReader();\n        reader.addEventListener('load', function() {\n          const image = document.createElement('img');\n          image.src = reader.result;\n          setImage(image);\n        });\n        reader.readAsDataURL(event.target.files[0]);\n        reset();\n      };\n      input.click();\n    }\n\n    setMouseState(0);\n  };\n\n  useEffect(() => {\n    if (hint === false) {\n      const photoSize = {width: photoSizes[sizeValue].width, height: photoSizes[sizeValue].height};\n      const outputSize = {width: outputSizes[outputValue].width, height: outputSizes[outputValue].height};\n      if (outputValue === 0) {\n        outputSize.width = photoSize.width;\n        outputSize.height = photoSize.height;\n      }\n      const numX = Math.floor(outputSize.width / (photoSize.width + 2));\n      const numY = Math.floor(outputSize.height / (photoSize.height + 2));\n      const dx = (outputSize.width - photoSize.width * numX) / (numX + 1);\n      const dy = (outputSize.height - photoSize.height * numY) / (numY + 1);\n      const offscreen = new OffscreenCanvas(outputSize.width, outputSize.height);\n      const ctx = offscreen.getContext('2d');\n      ctx.strokeStyle = '#000000';\n      ctx.fillStyle = '#ffffff';\n      ctx.fillRect(0, 0, outputSize.width, outputSize.height);\n      const dd = 5;\n      for (let j = 0; j < numY; ++j)\n        for (let i = 0; i < numX; ++i) {\n          const x = (dx + photoSize.width) * i + dx;\n          const y = (dy + photoSize.height) * j + dy;\n          ctx.drawImage(canvasRef.current, x, y);\n          if (numX > 1 || numY > 1) {\n            ctx.beginPath();\n            ctx.moveTo(x + dd, y - 1);\n            ctx.lineTo(x - 1, y - 1);\n            ctx.lineTo(x - 1, y + dd);\n            ctx.moveTo(x + photoSize.width + 1 - dd, y - 1);\n            ctx.lineTo(x + photoSize.width + 1, y - 1);\n            ctx.lineTo(x + photoSize.width + 1, y + dd);\n            ctx.moveTo(x - 1, y + photoSize.height + 1 - dd);\n            ctx.lineTo(x - 1, y + photoSize.height + 1);\n            ctx.lineTo(x + dd, y + photoSize.height + 1);\n            ctx.moveTo(x + photoSize.width + 1, y + photoSize.height + 1 - dd);\n            ctx.lineTo(x + photoSize.width + 1, y + photoSize.height + 1);\n            ctx.lineTo(x + photoSize.width - dd, y + photoSize.height + 1);\n            ctx.stroke();\n          }\n        }\n      offscreen.convertToBlob({type: 'image/jpeg', quality: 0.95})\n        .then((blob) => {\n          const reader = new FileReader();\n          reader.addEventListener('load', function() {\n            const download = document.createElement('a');\n            download.href = reader.result;\n            download.download = 'photo.jpg';\n            download.click();\n          });\n          reader.readAsDataURL(blob);\n        });\n      setHint(true);\n    }\n  }, [hint]);\n\n  return (\n    <div className='container' onMouseDown={onMouseDown} onMouseMove={onMouseMove} onMouseUp={onMouseUp} onClick={onClick}>\n      <div><SizeSelect options={photoSizes} value={sizeValue} onChange={onSizeChanged} /></div>\n      <div><Canvas canvasRef={canvasRef} size={photoSizes[sizeValue]} image={image} hint={hint} position={position} offset={offset} zoom={zoom} rotate={rotate} bright={bright} contrast={contrast} /></div>\n      <div><EditTool onZoomChanged={onZoomChanged} onRotateChanged={onRotateChanged} onBrightChanged={setBright} onContrastChanged={setContrast} resetRef={resetRef} /></div>\n      <p><OutputSelect options={outputSizes} value={outputValue} onChange={setOutputValue} /></p>\n      <div><Button type='primary' onClick={onSaveFile}>儲存檔案</Button></div>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}